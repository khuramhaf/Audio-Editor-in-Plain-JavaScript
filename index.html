<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="This is free online Audio Editor. The audio editor can 
    perform audio files merging/joining, trimming and cutting audio. You can also undo previous work.">
    <script src="https://cdn.jsdelivr.net/npm/lamejs@1.2.0/lame.min.js"></script>
    <title>Free Audio Editor</title>
</head>
<body>

    <a style="font-size: 20px; text-decoration: none;" href="index.html">Without Undo Feature </a>
    <a style="font-size: 20px; text-decoration: none; margin-left: 10px;" href="withundo.html">With Undo Feature </a>
    <h1>Free Online Audio Editor with Undo Feature</h1>
    <input  id = "file" type="file" onchange="myFunction()"/>
    <br/>
    <br/>
    <div>
    <span>Error: </span>
    <span style="color:red" id = "error"></span>
</div>
<br/>
    <div>
    <span>Audio Time: </span>
    <span id = 'timer'>0</span>
    <span style="margin-left:40px;">Audio Duration: </span>
    <span id = 'duration'>0</span>
    <span style="margin-left:40px;">Total Length: </span>
    <span id = 'totallength'>0</span>
    <span style="margin-left:40px;">Selected Length: </span>
    <span id = 'selectedlength'>0</span>
</div>

    <div style=" background-color:lightblue;padding:30px;">
    <h2>Playing, Cutting and Trimming Audio</h2>

    <p>To Play, Cut or Trim an audio file, you can specify the starting 
        and ending points. For instance, if you want to Play, Cut or Trim the audio from the 
        10th to the 20th second, simply input "10" as the starting point and "20" 
        as the ending point, and then click the "Play, Cut or Trim" button. Just export the file by clicking 
        on "Export button" in MP3 format after you finish editing. You can undo previous work by just pressing "z" key 
        on the keyboard. If you want use a app without "Undo feature" 
        click on "without undo feature" from the top.
    </p>
<label>Starting Point</label>
<br/>
<input oninput="keydownfun(this)" id = "start" type="text"/>
<br/>
<br/>
<label>Ending Point</label>
<br/>
<input oninput="keydownfun(this)" id = "end" type="text"/>
<br/>
<br/>

<button id ="play" onclick="play()">Play</button>
<button id ="play" onclick="stop()">Stop</button>
<button id ="trim1" onclick="trim()">Trim</button>
<button id="cut1" onclick="cut()">Cut</button>
<button id="exportdata1" onclick="exportdata()">Export</button>

</div>
    <h2>How to Use</h2>
<p>To use this app, you need to select an audio file by clicking "Choose File". After selecting the file, put the starting and ending points. The starting point is the starting value in seconds from where you want to cut or trim the audio, and the ending point is the ending value in seconds.
After providing the starting and ending points, you have two options: trim or cut the audio.

</p>
<h3>Difference between Trim and Cut</h3>
<p>Trimming means removing a specific part of the audio. For example, if your audio is 60 seconds long, and you want to trim 10 seconds in the middle, let's say you want to trim the audio from 10 seconds to 20 seconds. The trimming operation will remove the audio from 10 seconds to 20 seconds and save the rest of the audio.
</p>
<p>Cutting audio means you will get a specific part of the audio. For example, if you want to cut the audio from 10 seconds to 20 seconds, the cutting operation will return an audio file containing the audio between 10 seconds to 20 seconds.
</p>


<h3>Audio files Merging/Joining</h3>

<p>
    This application has the capability to join or merge multiple audio files together. 
    To accomplish this task, all you have to do is select the audio files you want to 
    combine. Simply press the "Choose file" button to pick a new file, and it will 
    automatically be added to the previously selected file.
</p>

<h3>Exporting Audio</h3>
<p>Once you done editing you can export file into and mp3 format by clicking "Export" button</p>
<p>Report any problem at <span style="color:blue;">contact@musk-technology.com</span></p>
    <script>

        var array = [];
        var audiocontext;
        var source;
        var time=0;
        let intervalid;
        var check = null;
        var sourcecheck = null;

        var undo=[];

        var array2 = [];

        document.addEventListener("keydown", function(event) {
if (event.key === "z"){


    if (undo.length >0){

        if (source){
    source.stop()
}

clearInterval(intervalid);
time = 0;

array = undo[undo.length-1];
undo.pop();


document.getElementById("totallength").innerHTML=array.length;
source = audiocontext.createBufferSource();
var array1 = new Float32Array(array);
var audiobuffer = audiocontext.createBuffer(1, array.length, audiocontext.sampleRate);
var ab1=  audiobuffer.getChannelData(0);
ab1.set(array);

source.buffer=audiobuffer;
source.connect(audiocontext.destination);
source.start(0);
document.getElementById("duration").innerHTML = source.buffer.duration;
if ( source.buffer.duration >=1){
intervalid =   setInterval(()=>{
time++;
document.getElementById("timer").innerHTML = time;
if (time === parseInt(source.buffer.duration)){
clearInterval(intervalid);
}
}, 1000);
}

}
    
}
});
        function keydownfun(){

            if (check!==null){

            var start =parseFloat(document.getElementById("start").value)
            var end =parseFloat(document.getElementById("end").value);
            var index = end*audiocontext.sampleRate - start*audiocontext.sampleRate;
            document.getElementById("selectedlength").innerHTML=parseInt(index);
        }

        document.getElementById("error").innerHTML = "";
        }

function myFunction() {


 
        clearInterval(intervalid);

    if (audiocontext === undefined){
 
 audiocontext= new AudioContext();
}


if (source){
 source.stop();
}


 const fr = new FileReader();

 fr.onload = function(){
  
   audiocontext.decodeAudioData(fr.result, function(audiofile){
    var x = audiofile.getChannelData(0);
    var y = Array.from(x);
    array = array.concat(y);

    document.getElementById("totallength").innerHTML=array.length;
    source = audiocontext.createBufferSource();
check = 1;
document.getElementById("error").innerHTML = "";
    time = 0;
   
    
    



   
var array1 = new Float32Array(array);
    var audiobuffer = audiocontext.createBuffer(1, array.length, audiocontext.sampleRate);
    var ab1=  audiobuffer.getChannelData(0);
 ab1.set(array);
       
       source.buffer=audiobuffer;
       source.connect(audiocontext.destination);
       source.start(0);
       document.getElementById("duration").innerHTML = source.buffer.duration;

   
intervalid =   setInterval(()=>{
        time++;
    document.getElementById("timer").innerHTML = time;

    if (time ===parseInt(source.buffer.duration)){
        clearInterval(intervalid);
    }
    
}, 1000);
    
   });

  
 } 
 var Files= document.getElementById("file").files
 file = Files[0];
 if (file){
  fr.readAsArrayBuffer(Files[0]);
}

document.getElementById("file").value = '';
}

function play(){

    clearInterval(intervalid);
    
    var start = parseFloat(document.getElementById("start").value);
var end = parseFloat(document.getElementById("end").value);

time = parseInt(start);


var final = end - start;

if (sourcecheck === null){

    
    if(source){
        source.stop();
    }
}

if (check === null ){

document.getElementById("error").innerHTML = "Please select a file"

}

else if (isNaN(start)){
document.getElementById("error").innerHTML = "Starting point is not a number"


}
else if (start >= source.buffer.duration){
document.getElementById("error").innerHTML = "starting point is greater than or equal to source buffer duration"

} 

else if (start < 0 )
{

document.getElementById("error").innerHTML = "Starting Point must be greater than 0"

}
else if (start >= end) {
document.getElementById("error").innerHTML = "Starting Point must be less than Ending Point"

}

else if (isNaN(end)){
document.getElementById("error").innerHTML = "Ending Point is not a number"
} 
else if ( end > source.buffer.duration ){

document.getElementById("error").innerHTML = "Ending point is greater than  duration"

end < 0 }

else if ( end <= start){

document.getElementById("error").innerHTML = "Ending Point is greater than equal to Starting Point"

}

else if (array.length <=0){

document.getElementById("error").innerHTML = "No data available"

}


    else{

        document.getElementById("timer").innerHTML = time;
        source = audiocontext.createBufferSource();
  
  var array1 = new Float32Array(array);
      var audiobuffer = audiocontext.createBuffer(1, array.length, audiocontext.sampleRate);
      var ab1=  audiobuffer.getChannelData(0);
   ab1.set(array);

 
         
         source.buffer=audiobuffer;
         source.connect(audiocontext.destination);
         source.start(0, start, final);
         
         document.getElementById("duration").innerHTML = source.buffer.duration;
     
if (parseInt(start) != parseInt(end)){
intervalid =   setInterval(()=>{
    
    time++;
    document.getElementById("timer").innerHTML = time;

    if (time === parseInt(end)){
        clearInterval(intervalid);
    }

}, 1000);
    
    }
  }
}

function stop(){
if (source){
    source.stop();
    clearInterval(intervalid);
}
}

function trim(){

    clearInterval(intervalid);
    var start = parseFloat(document.getElementById("start").value);
var end = parseFloat(document.getElementById("end").value);
time=0;
var final = end - start;


    if(source){
        source.stop();
    
}
   
    if (check === null ){

document.getElementById("error").innerHTML = "Please select a file"

}

else if (isNaN(start)){
document.getElementById("error").innerHTML = "Starting point is not a number"


}
else if (start >= source.buffer.duration){
document.getElementById("error").innerHTML = "starting point is greater than or equal to source buffer duration"

} 

else if (start < 0 )
{

document.getElementById("error").innerHTML = "Starting Point must be greater than 0"

}
else if (start >= end) {
document.getElementById("error").innerHTML = "Starting Point must be less than Ending Point"

}

else if (isNaN(end)){
document.getElementById("error").innerHTML = "Ending Point is not a number"
} 
else if ( end >= source.buffer.duration ){

document.getElementById("error").innerHTML = "Ending point is greater than or equal to  duration"

end < 0 }

else if ( end <= start){

document.getElementById("error").innerHTML = "Ending Point is greater than equal to Starting Point"

}

else if (array.length <=0){

document.getElementById("error").innerHTML = "No data available"

}

    else{
        
        document.getElementById("timer").innerHTML = time;
        var array4 = [...array];
        undo.push(array4);
        
        array.splice(parseInt(start*audiocontext.sampleRate), parseInt(final*audiocontext.sampleRate));
        
      
        
        document.getElementById("totallength").innerHTML=array.length;
source = audiocontext.createBufferSource();
var array1 = new Float32Array(array);
    var audiobuffer = audiocontext.createBuffer(1, array.length, audiocontext.sampleRate);
var ab1=  audiobuffer.getChannelData(0);
ab1.set(array);
   
   source.buffer=audiobuffer;
   source.connect(audiocontext.destination);
   source.start(0);
   document.getElementById("duration").innerHTML = source.buffer.duration;
   if ( source.buffer.duration >=1){
intervalid =   setInterval(()=>{
    time++;
document.getElementById("timer").innerHTML = time;
if (time === parseInt(source.buffer.duration)){
    clearInterval(intervalid);
}
}, 1000);
   }
}}



function cut(){

clearInterval(intervalid);
    var start = parseFloat(document.getElementById("start").value);
var end = parseFloat(document.getElementById("end").value);

var samplerate;
time=0;
    if(source){
        source.stop();
    }
   
  
    if (check === null ){

document.getElementById("error").innerHTML = "Please select a file"

}

else if (isNaN(start)){
document.getElementById("error").innerHTML = "Starting point is not a number"


}
else if (start >= source.buffer.duration){
document.getElementById("error").innerHTML = "starting point is greater than or equal to source buffer duration"

} 

else if (start < 0 )
{

document.getElementById("error").innerHTML = "Starting Point must be greater than 0"

}
else if (start >= end) {
document.getElementById("error").innerHTML = "Starting Point must be less than Ending Point"

}

else if (isNaN(end)){
document.getElementById("error").innerHTML = "Ending Point is not a number"
} 
else if ( end > source.buffer.duration ){

document.getElementById("error").innerHTML = "Ending point is greater than  duration"

end < 0 }

else if ( end <= start){

document.getElementById("error").innerHTML = "Ending Point is greater than equal to Starting Point"

}

else if (array.length <=0){

document.getElementById("error").innerHTML = "No data available"

}


    else{
        document.getElementById("timer").innerHTML = time;
        samplerate = source.buffer.sampleRate;
        var array1;

        if (end*source.buffer.sampleRate >= 1){
        
          
            var array3 = [...array];

undo.push(array3);
        array1 = array.slice(parseInt(start*audiocontext.sampleRate), parseInt(end*audiocontext.sampleRate));

        array = array1;


document.getElementById("totallength").innerHTML=array.length;
}
   source = audiocontext.createBufferSource();
  
array1 = new Float32Array(array);




    var audiobuffer =   audiocontext.createBuffer(1, array.length, audiocontext.sampleRate);
   var ab1=  audiobuffer.getChannelData(0);
ab1.set(array);
      
      source.buffer=audiobuffer;
      source.connect(audiocontext.destination);
      source.start(0);
      document.getElementById("duration").innerHTML = source.buffer.duration;
   if (source.buffer.duration<1){

   }
   else{
intervalid =   setInterval(()=>{
       time++;
   document.getElementById("timer").innerHTML = time;
   if (time === parseInt(source.buffer.duration)){
       clearInterval(intervalid);
   }
}, 1000);
    }
}


    
    




 

}



 function exportdata(){


 if (check!= null){
       
        var mp3Data = [];

var samples = new Int16Array(array.length);

var j = 0;
  for (var i = 0; i < array.length; i++) {
    samples[j++] = (array[i] * 0x7FFF);
  }
var mp3encoder = new lamejs.Mp3Encoder(1, source.buffer.sampleRate, 128);
 var mp3Tmp = mp3encoder.encodeBuffer(samples);
 mp3Data.push(mp3Tmp);

 const blob = new Blob(mp3Data, { type: "audio/mp3" });
  const audioURL = window.URL.createObjectURL(blob);
  var a = document.createElement("a");
  a.href = audioURL;
  a.download = "downloaded.mp3";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
    
}
}
    </script>
</body>
</html>